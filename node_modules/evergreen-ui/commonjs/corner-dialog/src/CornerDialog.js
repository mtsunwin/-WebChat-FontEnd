'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _uiBox = require('ui-box');

var _Transition = require('react-transition-group/Transition');

var _Transition2 = _interopRequireDefault(_Transition);

var _layers = require('../../layers');

var _portal = require('../../portal');

var _typography = require('../../typography');

var _buttons = require('../../buttons');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var animationEasing = {
  deceleration: 'cubic-bezier(0.0, 0.0, 0.2, 1)',
  acceleration: 'cubic-bezier(0.4, 0.0, 1, 1)',
  spring: 'cubic-bezier(0.175, 0.885, 0.320, 1.175)'
};

var ANIMATION_DURATION = 240;

var openAnimation = _uiBox.css.keyframes('openAnimation', {
  from: {
    transform: 'translateY(100%)'
  },
  to: {
    transform: 'translateY(0)'
  }
});

var closeAnimation = _uiBox.css.keyframes('closeAnimation', {
  from: {
    transform: 'scale(1)',
    opacity: 1
  },
  to: {
    transform: 'scale(0.9)',
    opacity: 0
  }
});

var animationStyles = {
  '&[data-state="entering"], &[data-state="entered"]': {
    animation: openAnimation + ' ' + ANIMATION_DURATION + 'ms ' + animationEasing.spring + ' both'
  },
  '&[data-state="exiting"]': {
    animation: closeAnimation + ' 120ms ' + animationEasing.acceleration + ' both'
  }
};

var CornerDialog = function (_PureComponent) {
  _inherits(CornerDialog, _PureComponent);

  function CornerDialog(props) {
    _classCallCheck(this, CornerDialog);

    var _this = _possibleConstructorReturn(this, (CornerDialog.__proto__ || Object.getPrototypeOf(CornerDialog)).call(this, props));

    _this.handleExited = function () {
      _this.setState({ exiting: false, exited: true });
      _this.props.onCloseComplete();
    };

    _this.handleClose = function () {
      _this.setState({ exiting: true });
    };

    _this.handleConfirm = function () {
      _this.props.onConfirm(_this.handleClose);
    };

    _this.renderChildren = function () {
      var children = _this.props.children;

      if (typeof children === 'function') {
        return children({ close: _this.handleClose });
      } else if (typeof children === 'string') {
        return _react2.default.createElement(
          _typography.Paragraph,
          { size: 400, color: 'muted' },
          children
        );
      }
      return children;
    };

    _this.state = {
      exiting: false,
      exited: !props.isShown
    };
    return _this;
  }

  _createClass(CornerDialog, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      if (nextProps.isShown && !this.props.isShown) {
        this.setState({
          exited: false
        });
      }
    }
  }, {
    key: 'render',
    value: function render() {
      var _this2 = this;

      var _props = this.props,
          title = _props.title,
          width = _props.width,
          isShown = _props.isShown,
          hasFooter = _props.hasFooter,
          hasCancel = _props.hasCancel,
          cancelLabel = _props.cancelLabel,
          confirmLabel = _props.confirmLabel,
          onOpenComplete = _props.onOpenComplete,
          containerProps = _props.containerProps;
      var _state = this.state,
          exiting = _state.exiting,
          exited = _state.exited;


      if (exited) return null;

      return _react2.default.createElement(
        _portal.Portal,
        null,
        _react2.default.createElement(
          _Transition2.default,
          {
            appear: true,
            unmountOnExit: true,
            timeout: ANIMATION_DURATION,
            'in': isShown && !exiting,
            onExited: this.handleExited,
            onEntered: onOpenComplete
          },
          function (state) {
            return _react2.default.createElement(
              _layers.Card,
              _extends({
                role: 'dialog',
                backgroundColor: 'white',
                elevation: 4,
                width: width,
                css: animationStyles,
                'data-state': state,
                position: 'fixed',
                bottom: 16,
                right: 16,
                padding: 32
              }, containerProps),
              _react2.default.createElement(
                _layers.Pane,
                { display: 'flex', alignItems: 'center', marginBottom: 12 },
                _react2.default.createElement(
                  _typography.Heading,
                  { is: 'h4', size: 600, flex: '1' },
                  title
                ),
                _react2.default.createElement(_buttons.IconButton, {
                  height: 32,
                  icon: 'close',
                  appearance: 'ghost',
                  onClick: _this2.handleClose
                })
              ),
              _react2.default.createElement(
                _layers.Pane,
                { overflowY: 'auto', 'data-state': state },
                _this2.renderChildren()
              ),
              hasFooter && _react2.default.createElement(
                _layers.Pane,
                {
                  marginTop: 24,
                  flexShrink: 0,
                  display: 'flex',
                  flexDirection: 'row-reverse'
                },
                _react2.default.createElement(
                  _buttons.Button,
                  {
                    appearance: 'green',
                    marginLeft: 8,
                    onClick: _this2.handleConfirm
                  },
                  confirmLabel
                ),
                hasCancel && _react2.default.createElement(
                  _buttons.Button,
                  { onClick: _this2.handleClose },
                  cancelLabel
                )
              )
            );
          }
        )
      );
    }
  }]);

  return CornerDialog;
}(_react.PureComponent);

CornerDialog.propTypes = {
  /**
   * Children can be a string, node or a function accepting `({ close })`.
   * When passing a string, <Paragraph size={400} color="muted" /> is used to wrap the string.
   */
  children: _propTypes2.default.oneOfType([_propTypes2.default.node, _propTypes2.default.func]).isRequired,

  /**
   * When true, the dialog is shown.
   */
  isShown: _propTypes2.default.bool,

  /**
   * Title of the Dialog. Titles should use Title Case.
   */
  title: _propTypes2.default.node,

  /**
   * Function that will be called when the exit transition is complete.
   */
  onCloseComplete: _propTypes2.default.func,

  /**
   * Function that will be called when the enter transition is complete.
   */
  onOpenComplete: _propTypes2.default.func,

  /**
   * When true, the footer with the cancel and confirm button is shown.
   */
  hasFooter: _propTypes2.default.bool,

  /**
   * Function that will be called when the confirm button is clicked.
   * This does not close the Dialog. A close function will be passed
   * as a paramater you can use to close the dialog.
   *
   * `onConfirm={(close) => close()}`
   */
  onConfirm: _propTypes2.default.func,

  /**
   * Label of the confirm button.
   */
  confirmLabel: _propTypes2.default.string,

  /**
   * When true, the cancel button is shown.
   */
  hasCancel: _propTypes2.default.bool,

  /**
   * Function that will be called when the cancel button is clicked.
   * This closes the Dialog by default.
   *
   * `onCancel={(close) => close()}`
   */
  onCancel: _propTypes2.default.func,

  /**
   * Label of the cancel button.
   */
  cancelLabel: _propTypes2.default.string,

  /**
   * Width of the Dialog.
   */
  width: _propTypes2.default.oneOfType([_propTypes2.default.string, _propTypes2.default.number]),

  /**
   * Props that are passed to the dialog container.
   */
  containerProps: _propTypes2.default.object
};
CornerDialog.defaultProps = {
  width: 392,
  hasFooter: true,
  confirmLabel: 'Learn More',
  hasCancel: true,
  cancelLabel: 'Close',
  onCancel: function onCancel(close) {
    return close();
  },
  onConfirm: function onConfirm(close) {
    return close();
  }
};
exports.default = CornerDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb3JuZXItZGlhbG9nL3NyYy9Db3JuZXJEaWFsb2cuanMiXSwibmFtZXMiOlsiYW5pbWF0aW9uRWFzaW5nIiwiZGVjZWxlcmF0aW9uIiwiYWNjZWxlcmF0aW9uIiwic3ByaW5nIiwiQU5JTUFUSU9OX0RVUkFUSU9OIiwib3BlbkFuaW1hdGlvbiIsImtleWZyYW1lcyIsImZyb20iLCJ0cmFuc2Zvcm0iLCJ0byIsImNsb3NlQW5pbWF0aW9uIiwib3BhY2l0eSIsImFuaW1hdGlvblN0eWxlcyIsImFuaW1hdGlvbiIsIkNvcm5lckRpYWxvZyIsInByb3BzIiwiaGFuZGxlRXhpdGVkIiwic2V0U3RhdGUiLCJleGl0aW5nIiwiZXhpdGVkIiwib25DbG9zZUNvbXBsZXRlIiwiaGFuZGxlQ2xvc2UiLCJoYW5kbGVDb25maXJtIiwib25Db25maXJtIiwicmVuZGVyQ2hpbGRyZW4iLCJjaGlsZHJlbiIsImNsb3NlIiwic3RhdGUiLCJpc1Nob3duIiwibmV4dFByb3BzIiwidGl0bGUiLCJ3aWR0aCIsImhhc0Zvb3RlciIsImhhc0NhbmNlbCIsImNhbmNlbExhYmVsIiwiY29uZmlybUxhYmVsIiwib25PcGVuQ29tcGxldGUiLCJjb250YWluZXJQcm9wcyIsInByb3BUeXBlcyIsIm9uZU9mVHlwZSIsIm5vZGUiLCJmdW5jIiwiaXNSZXF1aXJlZCIsImJvb2wiLCJzdHJpbmciLCJvbkNhbmNlbCIsIm51bWJlciIsIm9iamVjdCIsImRlZmF1bHRQcm9wcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7QUFDQTs7OztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7O0FBRUEsSUFBTUEsa0JBQWtCO0FBQ3RCQyxnREFEc0I7QUFFdEJDLDhDQUZzQjtBQUd0QkM7QUFIc0IsQ0FBeEI7O0FBTUEsSUFBTUMscUJBQXFCLEdBQTNCOztBQUVBLElBQU1DLGdCQUFnQixXQUFJQyxTQUFKLENBQWMsZUFBZCxFQUErQjtB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QUFvQixDQUFDLG9CQUFVQyxJQUFYLEVBQWlCLG9CQUFVQyxJQUEzQixDQUFwQixFQUFzREMsVUFML0M7O0FBT2pCOzs7QUFHQWQsV0FBUyxvQkFBVWUsSUFWRjs7QUFZakI7OztBQUdBYixTQUFPLG9CQUFVVSxJQWZBOztBQWlCakI7OztBQUdBcEIsbUJBQWlCLG9CQUFVcUIsSUFwQlY7O0FBc0JqQjs7O0FBR0FMLGtCQUFnQixvQkFBVUssSUF6QlQ7O0FBMkJqQjs7O0FBR0FULGFBQVcsb0JBQVVXLElBOUJKOztBQWdDakI7Ozs7Ozs7QUFPQXBCLGFBQVcsb0JBQVVrQixJQXZDSjs7QUF5Q2pCOzs7QUFHQU4sZ0JBQWMsb0JBQVVTLE1BNUNQOztBQThDakI7OztBQUdBWCxhQUFXLG9CQUFVVSxJQWpESjs7QUFtRGpCOzs7Ozs7QUFNQUUsWUFBVSxvQkFBVUosSUF6REg7O0FBMkRqQjs7O0FBR0FQLGVBQWEsb0JBQVVVLE1BOUROOztBQWdFakI7OztBQUdBYixTQUFPLG9CQUFVUSxTQUFWLENBQW9CLENBQUMsb0JBQVVLLE1BQVgsRUFBbUIsb0JBQVVFLE1BQTdCLENBQXBCLENBbkVVOztBQXFFakI7OztBQUdBVCxrQkFBZ0Isb0JBQVVVO0FBeEVULEM7QUFEQWpDLFksQ0E0RVprQyxZLEdBQWU7QUFDcEJqQixTQUFPLEdBRGE7QUFFcEJDLGFBQVcsSUFGUztBQUdwQkcsZ0JBQWMsWUFITTtBQUlwQkYsYUFBVyxJQUpTO0FBS3BCQyxlQUFhLE9BTE87QUFNcEJXLFlBQVU7QUFBQSxXQUFTbkIsT0FBVDtBQUFBLEdBTlU7QUFPcEJILGFBQVc7QUFBQSxXQUFTRyxPQUFUO0FBQUE7QUFQUyxDO2tCQTVFSFosWSIsImZpbGUiOiJDb3JuZXJEaWFsb2cuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgUHVyZUNvbXBvbmVudCB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IHsgY3NzIH0gZnJvbSAndWktYm94J1xuaW1wb3J0IFRyYW5zaXRpb24gZnJvbSAncmVhY3QtdHJhbnNpdGlvbi1ncm91cC9UcmFuc2l0aW9uJ1xuaW1wb3J0IHsgUGFuZSwgQ2FyZCB9IGZyb20gJy4uLy4uL2xheWVycydcbmltcG9ydCB7IFBvcnRhbCB9IGZyb20gJy4uLy4uL3BvcnRhbCdcbmltcG9ydCB7IFBhcmFncmFwaCwgSGVhZGluZyB9IGZyb20gJy4uLy4uL3R5cG9ncmFwaHknXG5pbXBvcnQgeyBCdXR0b24sIEljb25CdXR0b24gfSBmcm9tICcuLi8uLi9idXR0b25zJ1xuXG5jb25zdCBhbmltYXRpb25FYXNpbmcgPSB7XG4gIGRlY2VsZXJhdGlvbjogYGN1YmljLWJlemllcigwLjAsIDAuMCwgMC4yLCAxKWAsXG4gIGFjY2VsZXJhdGlvbjogYGN1YmljLWJlemllcigwLjQsIDAuMCwgMSwgMSlgLFxuICBzcHJpbmc6IGBjdWJpYy1iZXppZXIoMC4xNzUsIDAuODg1LCAwLjMyMCwgMS4xNzUpYFxufVxuXG5jb25zdCBBTklNQVRJT05fRFVSQVRJT04gPSAyNDBcblxuY29uc3Qgb3BlbkFuaW1hdGlvbiA9IGNzcy5rZXlmcmFtZXMoJ29wZW5BbmltYXRpb24nLCB7XG4gIGZyb206IHtcbiAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKDEwMCUpJ1xuICB9LFxuICB0bzoge1xuICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoMCknXG4gIH1cbn0pXG5cbmNvbnN0IGNsb3NlQW5pbWF0aW9uID0gY3NzLmtleWZyYW1lcygnY2xvc2VBbmltYXRpb24nLCB7XG4gIGZyb206IHtcbiAgICB0cmFuc2Zvcm06ICdzY2FsZSgxKScsXG4gICAgb3BhY2l0eTogMVxuICB9LFxuICB0bzoge1xuICAgIHRyYW5zZm9ybTogJ3NjYWxlKDAuOSknLFxuICAgIG9wYWNpdHk6IDBcbiAgfVxufSlcblxuY29uc3QgYW5pbWF0aW9uU3R5bGVzID0ge1xuICAnJltkYXRhLXN0YXRlPVwiZW50ZXJpbmdcIl0sICZbZGF0YS1zdGF0ZT1cImVudGVyZWRcIl0nOiB7XG4gICAgYW5pbWF0aW9uOiBgJHtvcGVuQW5pbWF0aW9ufSAke0FOSU1BVElPTl9EVVJBVElPTn1tcyAke1xuICAgICAgYW5pbWF0aW9uRWFzaW5nLnNwcmluZ1xuICAgIH0gYm90aGBcbiAgfSxcbiAgJyZbZGF0YS1zdGF0ZT1cImV4aXRpbmdcIl0nOiB7XG4gICAgYW5pbWF0aW9uOiBgJHtjbG9zZUFuaW1hdGlvbn0gMTIwbXMgJHthbmltYXRpb25FYXNpbmcuYWNjZWxlcmF0aW9ufSBib3RoYFxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvcm5lckRpYWxvZyBleHRlbmRzIFB1cmVDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIENoaWxkcmVuIGNhbiBiZSBhIHN0cmluZywgbm9kZSBvciBhIGZ1bmN0aW9uIGFjY2VwdGluZyBgKHsgY2xvc2UgfSlgLlxuICAgICAqIFdoZW4gcGFzc2luZyBhIHN0cmluZywgPFBhcmFncmFwaCBzaXplPXs0MDB9IGNvbG9yPVwibXV0ZWRcIiAvPiBpcyB1c2VkIHRvIHdyYXAgdGhlIHN0cmluZy5cbiAgICAgKi9cbiAgICBjaGlsZHJlbjogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm5vZGUsIFByb3BUeXBlcy5mdW5jXSkuaXNSZXF1aXJlZCxcblxuICAgIC8qKlxuICAgICAqIFdoZW4gdHJ1ZSwgdGhlIGRpYWxvZyBpcyBzaG93bi5cbiAgICAgKi9cbiAgICBpc1Nob3duOiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIC8qKlxuICAgICAqIFRpdGxlIG9mIHRoZSBEaWFsb2cuIFRpdGxlcyBzaG91bGQgdXNlIFRpdGxlIENhc2UuXG4gICAgICovXG4gICAgdGl0bGU6IFByb3BUeXBlcy5ub2RlLFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBleGl0IHRyYW5zaXRpb24gaXMgY29tcGxldGUuXG4gICAgICovXG4gICAgb25DbG9zZUNvbXBsZXRlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgZW50ZXIgdHJhbnNpdGlvbiBpcyBjb21wbGV0ZS5cbiAgICAgKi9cbiAgICBvbk9wZW5Db21wbGV0ZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgICAvKipcbiAgICAgKiBXaGVuIHRydWUsIHRoZSBmb290ZXIgd2l0aCB0aGUgY2FuY2VsIGFuZCBjb25maXJtIGJ1dHRvbiBpcyBzaG93bi5cbiAgICAgKi9cbiAgICBoYXNGb290ZXI6IFByb3BUeXBlcy5ib29sLFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBjb25maXJtIGJ1dHRvbiBpcyBjbGlja2VkLlxuICAgICAqIFRoaXMgZG9lcyBub3QgY2xvc2UgdGhlIERpYWxvZy4gQSBjbG9zZSBmdW5jdGlvbiB3aWxsIGJlIHBhc3NlZFxuICAgICAqIGFzIGEgcGFyYW1hdGVyIHlvdSBjYW4gdXNlIHRvIGNsb3NlIHRoZSBkaWFsb2cuXG4gICAgICpcbiAgICAgKiBgb25Db25maXJtPXsoY2xvc2UpID0+IGNsb3NlKCl9YFxuICAgICAqL1xuICAgIG9uQ29uZmlybTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgICAvKipcbiAgICAgKiBMYWJlbCBvZiB0aGUgY29uZmlybSBidXR0b24uXG4gICAgICovXG4gICAgY29uZmlybUxhYmVsOiBQcm9wVHlwZXMuc3RyaW5nLFxuXG4gICAgLyoqXG4gICAgICogV2hlbiB0cnVlLCB0aGUgY2FuY2VsIGJ1dHRvbiBpcyBzaG93bi5cbiAgICAgKi9cbiAgICBoYXNDYW5jZWw6IFByb3BUeXBlcy5ib29sLFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBjYW5jZWwgYnV0dG9uIGlzIGNsaWNrZWQuXG4gICAgICogVGhpcyBjbG9zZXMgdGhlIERpYWxvZyBieSBkZWZhdWx0LlxuICAgICAqXG4gICAgICogYG9uQ2FuY2VsPXsoY2xvc2UpID0+IGNsb3NlKCl9YFxuICAgICAqL1xuICAgIG9uQ2FuY2VsOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIExhYmVsIG9mIHRoZSBjYW5jZWwgYnV0dG9uLlxuICAgICAqL1xuICAgIGNhbmNlbExhYmVsOiBQcm9wVHlwZXMuc3RyaW5nLFxuXG4gICAgLyoqXG4gICAgICogV2lkdGggb2YgdGhlIERpYWxvZy5cbiAgICAgKi9cbiAgICB3aWR0aDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLnN0cmluZywgUHJvcFR5cGVzLm51bWJlcl0pLFxuXG4gICAgLyoqXG4gICAgICogUHJvcHMgdGhhdCBhcmUgcGFzc2VkIHRvIHRoZSBkaWFsb2cgY29udGFpbmVyLlxuICAgICAqL1xuICAgIGNvbnRhaW5lclByb3BzOiBQcm9wVHlwZXMub2JqZWN0XG4gIH1cblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIHdpZHRoOiAzOTIsXG4gICAgaGFzRm9vdGVyOiB0cnVlLFxuICAgIGNvbmZpcm1MYWJlbDogJ0xlYXJuIE1vcmUnLFxuICAgIGhhc0NhbmNlbDogdHJ1ZSxcbiAgICBjYW5jZWxMYWJlbDogJ0Nsb3NlJyxcbiAgICBvbkNhbmNlbDogY2xvc2UgPT4gY2xvc2UoKSxcbiAgICBvbkNvbmZpcm06IGNsb3NlID0+IGNsb3NlKClcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpXG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgZXhpdGluZzogZmFsc2UsXG4gICAgICBleGl0ZWQ6ICFwcm9wcy5pc1Nob3duXG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICBpZiAobmV4dFByb3BzLmlzU2hvd24gJiYgIXRoaXMucHJvcHMuaXNTaG93bikge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGV4aXRlZDogZmFsc2VcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgaGFuZGxlRXhpdGVkID0gKCkgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBleGl0aW5nOiBmYWxzZSwgZXhpdGVkOiB0cnVlIH0pXG4gICAgdGhpcy5wcm9wcy5vbkNsb3NlQ29tcGxldGUoKVxuICB9XG5cbiAgaGFuZGxlQ2xvc2UgPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGV4aXRpbmc6IHRydWUgfSlcbiAgfVxuXG4gIGhhbmRsZUNvbmZpcm0gPSAoKSA9PiB7XG4gICAgdGhpcy5wcm9wcy5vbkNvbmZpcm0odGhpcy5oYW5kbGVDbG9zZSlcbiAgfVxuXG4gIHJlbmRlckNoaWxkcmVuID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgY2hpbGRyZW4gfSA9IHRoaXMucHJvcHNcbiAgICBpZiAodHlwZW9mIGNoaWxkcmVuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gY2hpbGRyZW4oeyBjbG9zZTogdGhpcy5oYW5kbGVDbG9zZSB9KVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGNoaWxkcmVuID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFBhcmFncmFwaCBzaXplPXs0MDB9IGNvbG9yPVwibXV0ZWRcIj5cbiAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgIDwvUGFyYWdyYXBoPlxuICAgICAgKVxuICAgIH1cbiAgICByZXR1cm4gY2hpbGRyZW5cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICB0aXRsZSxcbiAgICAgIHdpZHRoLFxuICAgICAgaXNTaG93bixcbiAgICAgIGhhc0Zvb3RlcixcbiAgICAgIGhhc0NhbmNlbCxcbiAgICAgIGNhbmNlbExhYmVsLFxuICAgICAgY29uZmlybUxhYmVsLFxuICAgICAgb25PcGVuQ29tcGxldGUsXG4gICAgICBjb250YWluZXJQcm9wc1xuICAgIH0gPSB0aGlzLnByb3BzXG5cbiAgICBjb25zdCB7IGV4aXRpbmcsIGV4aXRlZCB9ID0gdGhpcy5zdGF0ZVxuXG4gICAgaWYgKGV4aXRlZCkgcmV0dXJuIG51bGxcblxuICAgIHJldHVybiAoXG4gICAgICA8UG9ydGFsPlxuICAgICAgICA8VHJhbnNpdGlvblxuICAgICAgICAgIGFwcGVhclxuICAgICAgICAgIHVubW91bnRPbkV4aXRcbiAgICAgICAgICB0aW1lb3V0PXtBTklNQVRJT05fRFVSQVRJT059XG4gICAgICAgICAgaW49e2lzU2hvd24gJiYgIWV4aXRpbmd9XG4gICAgICAgICAgb25FeGl0ZWQ9e3RoaXMuaGFuZGxlRXhpdGVkfVxuICAgICAgICAgIG9uRW50ZXJlZD17b25PcGVuQ29tcGxldGV9XG4gICAgICAgID5cbiAgICAgICAgICB7c3RhdGUgPT4gKFxuICAgICAgICAgICAgPENhcmRcbiAgICAgICAgICAgICAgcm9sZT1cImRpYWxvZ1wiXG4gICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcj1cIndoaXRlXCJcbiAgICAgICAgICAgICAgZWxldmF0aW9uPXs0fVxuICAgICAgICAgICAgICB3aWR0aD17d2lkdGh9XG4gICAgICAgICAgICAgIGNzcz17YW5pbWF0aW9uU3R5bGVzfVxuICAgICAgICAgICAgICBkYXRhLXN0YXRlPXtzdGF0ZX1cbiAgICAgICAgICAgICAgcG9zaXRpb249XCJmaXhlZFwiXG4gICAgICAgICAgICAgIGJvdHRvbT17MTZ9XG4gICAgICAgICAgICAgIHJpZ2h0PXsxNn1cbiAgICAgICAgICAgICAgcGFkZGluZz17MzJ9XG4gICAgICAgICAgICAgIHsuLi5jb250YWluZXJQcm9wc31cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPFBhbmUgZGlzcGxheT1cImZsZXhcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgbWFyZ2luQm90dG9tPXsxMn0+XG4gICAgICAgICAgICAgICAgPEhlYWRpbmcgaXM9XCJoNFwiIHNpemU9ezYwMH0gZmxleD1cIjFcIj5cbiAgICAgICAgICAgICAgICAgIHt0aXRsZX1cbiAgICAgICAgICAgICAgICA8L0hlYWRpbmc+XG4gICAgICAgICAgICAgICAgPEljb25CdXR0b25cbiAgICAgICAgICAgICAgICAgIGhlaWdodD17MzJ9XG4gICAgICAgICAgICAgICAgICBpY29uPVwiY2xvc2VcIlxuICAgICAgICAgICAgICAgICAgYXBwZWFyYW5jZT1cImdob3N0XCJcbiAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuaGFuZGxlQ2xvc2V9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPC9QYW5lPlxuXG4gICAgICAgICAgICAgIDxQYW5lIG92ZXJmbG93WT1cImF1dG9cIiBkYXRhLXN0YXRlPXtzdGF0ZX0+XG4gICAgICAgICAgICAgICAge3RoaXMucmVuZGVyQ2hpbGRyZW4oKX1cbiAgICAgICAgICAgICAgPC9QYW5lPlxuXG4gICAgICAgICAgICAgIHtoYXNGb290ZXIgJiYgKFxuICAgICAgICAgICAgICAgIDxQYW5lXG4gICAgICAgICAgICAgICAgICBtYXJnaW5Ub3A9ezI0fVxuICAgICAgICAgICAgICAgICAgZmxleFNocmluaz17MH1cbiAgICAgICAgICAgICAgICAgIGRpc3BsYXk9XCJmbGV4XCJcbiAgICAgICAgICAgICAgICAgIGZsZXhEaXJlY3Rpb249XCJyb3ctcmV2ZXJzZVwiXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBhcHBlYXJhbmNlPVwiZ3JlZW5cIlxuICAgICAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0PXs4fVxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLmhhbmRsZUNvbmZpcm19XG4gICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHtjb25maXJtTGFiZWx9XG4gICAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICAgIHtoYXNDYW5jZWwgJiYgKFxuICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e3RoaXMuaGFuZGxlQ2xvc2V9PntjYW5jZWxMYWJlbH08L0J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgPC9QYW5lPlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgPC9DYXJkPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvVHJhbnNpdGlvbj5cbiAgICAgIDwvUG9ydGFsPlxuICAgIClcbiAgfVxufVxuIl19