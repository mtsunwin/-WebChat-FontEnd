'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _glamor = require('glamor');

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _Transition = require('react-transition-group/Transition');

var _Transition2 = _interopRequireDefault(_Transition);

var _Alert = require('../../alert/src/Alert');

var _Alert2 = _interopRequireDefault(_Alert);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var animationEasing = {
  deceleration: 'cubic-bezier(0.0, 0.0, 0.2, 1)',
  acceleration: 'cubic-bezier(0.4, 0.0, 1, 1)',
  spring: 'cubic-bezier(0.175, 0.885, 0.320, 1.175)'
};

var ANIMATION_DURATION = 240;

var openAnimation = _glamor.css.keyframes('openAnimation', {
  from: {
    opacity: 0,
    transform: 'translateY(-120%)'
  },
  to: {
    transform: 'translateY(0)'
  }
});

var closeAnimation = _glamor.css.keyframes('closeAnimation', {
  from: {
    transform: 'scale(1)',
    opacity: 1
  },
  to: {
    transform: 'scale(0.9)',
    opacity: 0
  }
});

var animationStyles = (0, _glamor.css)({
  display: 'flex',
  flexDirection: 'column',
  alignItems: 'center',
  height: 0,
  transition: 'all ' + ANIMATION_DURATION + 'ms ' + animationEasing.deceleration,
  '&[data-state="entering"], &[data-state="entered"]': {
    animation: openAnimation + ' ' + ANIMATION_DURATION + 'ms ' + animationEasing.spring + ' both'
  },
  '&[data-state="exiting"]': {
    animation: closeAnimation + ' 120ms ' + animationEasing.acceleration + ' both'
  }
});

var Toast = function (_React$PureComponent) {
  _inherits(Toast, _React$PureComponent);

  function Toast() {
    var _ref;

    var _temp, _this, _ret;

    _classCallCheck(this, Toast);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = Toast.__proto__ || Object.getPrototypeOf(Toast)).call.apply(_ref, [this].concat(args))), _this), _this.state = {
      isShown: true,
      height: 0
    }, _this.close = function () {
      _this.clearCloseTimer();
      _this.setState({
        isShown: false
      });
    }, _this.startCloseTimer = function () {
      if (_this.props.duration) {
        _this.closeTimer = setTimeout(function () {
          _this.close();
        }, _this.props.duration * 1000);
      }
    }, _this.clearCloseTimer = function () {
      if (_this.closeTimer) {
        clearTimeout(_this.closeTimer);
        _this.closeTimer = null;
      }
    }, _this.handleMouseEnter = function () {
      _this.clearCloseTimer();
    }, _this.handleMouseLeave = function () {
      _this.startCloseTimer();
    }, _this.onRef = function (ref) {
      if (ref === null) return;

      var height = ref.getBoundingClientRect().height;

      _this.setState({
        height: height
      });
    }, _temp), _possibleConstructorReturn(_this, _ret);
  }

  _createClass(Toast, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      if (Object.hasOwnProperty.call(nextProps, 'isShown')) {
        this.setState({
          isShown: nextProps.isShown
        });
      }
    }
  }, {
    key: 'componentDidMount',
    value: function componentDidMount() {
      this.startCloseTimer();
    }
  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      this.clearCloseTimer();
    }
  }, {
    key: 'render',
    value: function render() {
      var _this2 = this;

      return _react2.default.createElement(
        _Transition2.default,
        {
          appear: true,
          unmountOnExit: true,
          timeout: ANIMATION_DURATION,
          'in': this.state.isShown,
          onExited: this.props.onRemove
        },
        function (state) {
          return _react2.default.createElement(
            'div',
            {
              'data-state': state,
              className: animationStyles,
              onMouseEnter: _this2.handleMouseEnter,
              onMouseLeave: _this2.handleMouseLeave,
              style: {
                height: _this2.state.height,
                zIndex: _this2.props.zIndex,
                marginBottom: _this2.state.isShown ? 0 : -_this2.state.height
              }
            },
            _react2.default.createElement(
              'div',
              { ref: _this2.onRef, style: { padding: 8 } },
              _react2.default.createElement(
                _Alert2.default,
                {
                  flexShrink: 0,
                  appearance: 'card',
                  elevation: 3,
                  type: _this2.props.type,
                  title: _this2.props.title,
                  isRemoveable: _this2.props.hasCloseButton,
                  onRemove: function onRemove() {
                    return _this2.close();
                  },
                  pointerEvents: 'all'
                },
                _this2.props.children
              )
            )
          );
        }
      );
    }
  }]);

  return Toast;
}(_react2.default.PureComponent);

Toast.propTypes = {
  /**
   * The z-index of the toast.
   */
  zIndex: _propTypes2.default.number,

  /**
   * Duration of the toast.
   */
  duration: _propTypes2.default.number,

  /**
   * Function called when the toast is all the way closed.
   */
  onRemove: _propTypes2.default.func,

  /**
   * The type of the alert.
   */
  type: _propTypes2.default.oneOf(['default', 'success', 'warning', 'danger', 'question']),

  /**
   * The title of the alert.
   */
  title: _propTypes2.default.node,

  /**
   * Description of the alert.
   */
  children: _propTypes2.default.node,

  /**
   * When true, show a close icon button inside of the toast.
   */
  hasCloseButton: _propTypes2.default.bool,

  /**
   * When false, will close the Toast and call onRemove when finished.
   */
  isShown: _propTypes2.default.bool
};
exports.default = Toast;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90b2FzdGVyL3NyYy9Ub2FzdC5qcyJdLCJuYW1lcyI6WyJhbmltYXRpb25FYXNpbmciLCJkZWNlbGVyYXRpb24iLCJhY2NlbGVyYXRpb24iLCJzcHJpbmciLCJBTklNQVRJT05fRFVSQVRJT04iLCJvcGVuQW5pbWF0aW9uIiwia2V5ZnJhbWVzIiwiZnJvbSIsIm9wYWNpdHkiLCJ0cmFuc2Zvcm0iLCJ0byIsImNsb3NlQW5pbWF0aW9uIiwiYW5pbWF0aW9uU3R5bGVzIiwiZGlzcGxheSIsImZsZXhEaXJlY3Rpb24iLCJhbGlnbkl0ZW1zIiwiaGVpZ2h0IiwidHJhbnNpdGlvbiIsImFuaW1hdGlvbiIsIlRvYXN0Iiwic3RhdGUiLCJpc1Nob3duIiwiY2xvc2UiLCJjbGVhckNsb3NlVGltZXIiLCJzZXRTdGF0ZSIsInN0YXJ0Q2xvc2VUaW1lciIsInByb3BzIiwiZHVyYXRpb24iLCJjbG9zZVRpbWVyIiwic2V0VGltZW91dCIsImNsZWFyVGltZW91dCIsImhhbmRsZU1vdXNlRW50ZXIiLCJoYW5kbGVNb3VzZUxlYXZlIiwib25SZWYiLCJyZWYiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJuZXh0UHJvcHMiLCJPYmplY3QiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJvblJlbW92ZSIsInpJbmRleCIsIm1hcmdpbkJvdHRvbSIsInBhZGRpbmciLCJ0eXBlIiwidGl0bGUiLCJoYXNDbG9zZUJ1dHRvbiIsImNoaWxkcmVuIiwiUHVyZUNvbXBvbmVudCIsInByb3BUeXBlcyIsIm51bWJlciIsImZ1bmMiLCJvbmVPZiIsIm5vZGUiLCJib29sIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxrQkFBa0I7QUFDdEJDLGdEQURzQjtBQUV0QkMsOENBRnNCO0FBR3RCQztBQUhzQixDQUF4Qjs7QUFNQSxJQUFNQyxxQkFBcUIsR0FBM0I7O0FBRUEsSUFB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Q29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBjc3MgfSBmcm9tICdnbGFtb3InXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnXG5pbXBvcnQgVHJhbnNpdGlvbiBmcm9tICdyZWFjdC10cmFuc2l0aW9uLWdyb3VwL1RyYW5zaXRpb24nXG5pbXBvcnQgQWxlcnQgZnJvbSAnLi4vLi4vYWxlcnQvc3JjL0FsZXJ0J1xuXG5jb25zdCBhbmltYXRpb25FYXNpbmcgPSB7XG4gIGRlY2VsZXJhdGlvbjogYGN1YmljLWJlemllcigwLjAsIDAuMCwgMC4yLCAxKWAsXG4gIGFjY2VsZXJhdGlvbjogYGN1YmljLWJlemllcigwLjQsIDAuMCwgMSwgMSlgLFxuICBzcHJpbmc6IGBjdWJpYy1iZXppZXIoMC4xNzUsIDAuODg1LCAwLjMyMCwgMS4xNzUpYFxufVxuXG5jb25zdCBBTklNQVRJT05fRFVSQVRJT04gPSAyNDBcblxuY29uc3Qgb3BlbkFuaW1hdGlvbiA9IGNzcy5rZXlmcmFtZXMoJ29wZW5BbmltYXRpb24nLCB7XG4gIGZyb206IHtcbiAgICBvcGFjaXR5OiAwLFxuICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoLTEyMCUpJ1xuICB9LFxuICB0bzoge1xuICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoMCknXG4gIH1cbn0pXG5cbmNvbnN0IGNsb3NlQW5pbWF0aW9uID0gY3NzLmtleWZyYW1lcygnY2xvc2VBbmltYXRpb24nLCB7XG4gIGZyb206IHtcbiAgICB0cmFuc2Zvcm06ICdzY2FsZSgxKScsXG4gICAgb3BhY2l0eTogMVxuICB9LFxuICB0bzoge1xuICAgIHRyYW5zZm9ybTogJ3NjYWxlKDAuOSknLFxuICAgIG9wYWNpdHk6IDBcbiAgfVxufSlcblxuY29uc3QgYW5pbWF0aW9uU3R5bGVzID0gY3NzKHtcbiAgZGlzcGxheTogJ2ZsZXgnLFxuICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJyxcbiAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gIGhlaWdodDogMCxcbiAgdHJhbnNpdGlvbjogYGFsbCAke0FOSU1BVElPTl9EVVJBVElPTn1tcyAke2FuaW1hdGlvbkVhc2luZy5kZWNlbGVyYXRpb259YCxcbiAgJyZbZGF0YS1zdGF0ZT1cImVudGVyaW5nXCJdLCAmW2RhdGEtc3RhdGU9XCJlbnRlcmVkXCJdJzoge1xuICAgIGFuaW1hdGlvbjogYCR7b3BlbkFuaW1hdGlvbn0gJHtBTklNQVRJT05fRFVSQVRJT059bXMgJHtcbiAgICAgIGFuaW1hdGlvbkVhc2luZy5zcHJpbmdcbiAgICB9IGJvdGhgXG4gIH0sXG4gICcmW2RhdGEtc3RhdGU9XCJleGl0aW5nXCJdJzoge1xuICAgIGFuaW1hdGlvbjogYCR7Y2xvc2VBbmltYXRpb259IDEyMG1zICR7YW5pbWF0aW9uRWFzaW5nLmFjY2VsZXJhdGlvbn0gYm90aGBcbiAgfVxufSlcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVG9hc3QgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAvKipcbiAgICAgKiBUaGUgei1pbmRleCBvZiB0aGUgdG9hc3QuXG4gICAgICovXG4gICAgekluZGV4OiBQcm9wVHlwZXMubnVtYmVyLFxuXG4gICAgLyoqXG4gICAgICogRHVyYXRpb24gb2YgdGhlIHRvYXN0LlxuICAgICAqL1xuICAgIGR1cmF0aW9uOiBQcm9wVHlwZXMubnVtYmVyLFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gY2FsbGVkIHdoZW4gdGhlIHRvYXN0IGlzIGFsbCB0aGUgd2F5IGNsb3NlZC5cbiAgICAgKi9cbiAgICBvblJlbW92ZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgICAvKipcbiAgICAgKiBUaGUgdHlwZSBvZiB0aGUgYWxlcnQuXG4gICAgICovXG4gICAgdHlwZTogUHJvcFR5cGVzLm9uZU9mKFtcbiAgICAgICdkZWZhdWx0JyxcbiAgICAgICdzdWNjZXNzJyxcbiAgICAgICd3YXJuaW5nJyxcbiAgICAgICdkYW5nZXInLFxuICAgICAgJ3F1ZXN0aW9uJ1xuICAgIF0pLFxuXG4gICAgLyoqXG4gICAgICogVGhlIHRpdGxlIG9mIHRoZSBhbGVydC5cbiAgICAgKi9cbiAgICB0aXRsZTogUHJvcFR5cGVzLm5vZGUsXG5cbiAgICAvKipcbiAgICAgKiBEZXNjcmlwdGlvbiBvZiB0aGUgYWxlcnQuXG4gICAgICovXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlLFxuXG4gICAgLyoqXG4gICAgICogV2hlbiB0cnVlLCBzaG93IGEgY2xvc2UgaWNvbiBidXR0b24gaW5zaWRlIG9mIHRoZSB0b2FzdC5cbiAgICAgKi9cbiAgICBoYXNDbG9zZUJ1dHRvbjogUHJvcFR5cGVzLmJvb2wsXG5cbiAgICAvKipcbiAgICAgKiBXaGVuIGZhbHNlLCB3aWxsIGNsb3NlIHRoZSBUb2FzdCBhbmQgY2FsbCBvblJlbW92ZSB3aGVuIGZpbmlzaGVkLlxuICAgICAqL1xuICAgIGlzU2hvd246IFByb3BUeXBlcy5ib29sXG4gIH1cblxuICBzdGF0ZSA9IHtcbiAgICBpc1Nob3duOiB0cnVlLFxuICAgIGhlaWdodDogMFxuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwobmV4dFByb3BzLCAnaXNTaG93bicpKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgaXNTaG93bjogbmV4dFByb3BzLmlzU2hvd25cbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgdGhpcy5zdGFydENsb3NlVGltZXIoKVxuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgdGhpcy5jbGVhckNsb3NlVGltZXIoKVxuICB9XG5cbiAgY2xvc2UgPSAoKSA9PiB7XG4gICAgdGhpcy5jbGVhckNsb3NlVGltZXIoKVxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgaXNTaG93bjogZmFsc2VcbiAgICB9KVxuICB9XG5cbiAgc3RhcnRDbG9zZVRpbWVyID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLnByb3BzLmR1cmF0aW9uKSB7XG4gICAgICB0aGlzLmNsb3NlVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5jbG9zZSgpXG4gICAgICB9LCB0aGlzLnByb3BzLmR1cmF0aW9uICogMTAwMClcbiAgICB9XG4gIH1cblxuICBjbGVhckNsb3NlVGltZXIgPSAoKSA9PiB7XG4gICAgaWYgKHRoaXMuY2xvc2VUaW1lcikge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuY2xvc2VUaW1lcilcbiAgICAgIHRoaXMuY2xvc2VUaW1lciA9IG51bGxcbiAgICB9XG4gIH1cblxuICBoYW5kbGVNb3VzZUVudGVyID0gKCkgPT4ge1xuICAgIHRoaXMuY2xlYXJDbG9zZVRpbWVyKClcbiAgfVxuXG4gIGhhbmRsZU1vdXNlTGVhdmUgPSAoKSA9PiB7XG4gICAgdGhpcy5zdGFydENsb3NlVGltZXIoKVxuICB9XG5cbiAgb25SZWYgPSByZWYgPT4ge1xuICAgIGlmIChyZWYgPT09IG51bGwpIHJldHVyblxuXG4gICAgY29uc3QgaGVpZ2h0ID0gcmVmLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodFxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBoZWlnaHRcbiAgICB9KVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8VHJhbnNpdGlvblxuICAgICAgICBhcHBlYXJcbiAgICAgICAgdW5tb3VudE9uRXhpdFxuICAgICAgICB0aW1lb3V0PXtBTklNQVRJT05fRFVSQVRJT059XG4gICAgICAgIGluPXt0aGlzLnN0YXRlLmlzU2hvd259XG4gICAgICAgIG9uRXhpdGVkPXt0aGlzLnByb3BzLm9uUmVtb3ZlfVxuICAgICAgPlxuICAgICAgICB7c3RhdGUgPT4gKFxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIGRhdGEtc3RhdGU9e3N0YXRlfVxuICAgICAgICAgICAgY2xhc3NOYW1lPXthbmltYXRpb25TdHlsZXN9XG4gICAgICAgICAgICBvbk1vdXNlRW50ZXI9e3RoaXMuaGFuZGxlTW91c2VFbnRlcn1cbiAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17dGhpcy5oYW5kbGVNb3VzZUxlYXZlfVxuICAgICAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLnN0YXRlLmhlaWdodCxcbiAgICAgICAgICAgICAgekluZGV4OiB0aGlzLnByb3BzLnpJbmRleCxcbiAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiB0aGlzLnN0YXRlLmlzU2hvd24gPyAwIDogLXRoaXMuc3RhdGUuaGVpZ2h0XG4gICAgICAgICAgICB9fVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxkaXYgcmVmPXt0aGlzLm9uUmVmfSBzdHlsZT17eyBwYWRkaW5nOiA4IH19PlxuICAgICAgICAgICAgICA8QWxlcnRcbiAgICAgICAgICAgICAgICBmbGV4U2hyaW5rPXswfVxuICAgICAgICAgICAgICAgIGFwcGVhcmFuY2U9XCJjYXJkXCJcbiAgICAgICAgICAgICAgICBlbGV2YXRpb249ezN9XG4gICAgICAgICAgICAgICAgdHlwZT17dGhpcy5wcm9wcy50eXBlfVxuICAgICAgICAgICAgICAgIHRpdGxlPXt0aGlzLnByb3BzLnRpdGxlfVxuICAgICAgICAgICAgICAgIGlzUmVtb3ZlYWJsZT17dGhpcy5wcm9wcy5oYXNDbG9zZUJ1dHRvbn1cbiAgICAgICAgICAgICAgICBvblJlbW92ZT17KCkgPT4gdGhpcy5jbG9zZSgpfVxuICAgICAgICAgICAgICAgIHBvaW50ZXJFdmVudHM9XCJhbGxcIlxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge3RoaXMucHJvcHMuY2hpbGRyZW59XG4gICAgICAgICAgICAgIDwvQWxlcnQ+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKX1cbiAgICAgIDwvVHJhbnNpdGlvbj5cbiAgICApXG4gIH1cbn1cbiJdfQ==