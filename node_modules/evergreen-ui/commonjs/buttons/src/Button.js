'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _typography = require('../../typography');

var _icons = require('../../icons');

var _sharedStyles = require('../../shared-styles');

var _spinner = require('../../spinner');

var _ButtonAppearances = require('./styles/ButtonAppearances');

var _ButtonAppearances2 = _interopRequireDefault(_ButtonAppearances);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Button = function (_PureComponent) {
  _inherits(Button, _PureComponent);

  function Button() {
    _classCallCheck(this, Button);

    return _possibleConstructorReturn(this, (Button.__proto__ || Object.getPrototypeOf(Button)).apply(this, arguments));
  }

  _createClass(Button, [{
    key: 'render',
    value: function render() {
      var _props = this.props,
          css = _props.css,
          height = _props.height,
          isActive = _props.isActive,
          children = _props.children,
          disabled = _props.disabled,
          appearance = _props.appearance,
          isLoading = _props.isLoading,
          paddingRight = _props.paddingRight,
          paddingLeft = _props.paddingLeft,
          paddingTop = _props.paddingTop,
          paddingBottom = _props.paddingBottom,
          iconBeforeKey = _props.iconBefore,
          iconBeforeAim = _props.iconBeforeAim,
          iconAfterKey = _props.iconAfter,
          iconAfterAim = _props.iconAfterAim,
          props = _objectWithoutProperties(_props, ['css', 'height', 'isActive', 'children', 'disabled', 'appearance', 'isLoading', 'paddingRight', 'paddingLeft', 'paddingTop', 'paddingBottom', 'iconBefore', 'iconBeforeAim', 'iconAfter', 'iconAfterAim']);

      var appearanceStyle = _ButtonAppearances2.default[appearance];
      var textStyle = (0, _sharedStyles.getTextStyleForControlHeight)({ height: height });
      var borderRadius = (0, _sharedStyles.getBorderRadiusForControlHeight)({ height: height });
      var iconHeight = height - 4;
      var iconSize = (0, _sharedStyles.getIconSizeForControlHeight)({ height: iconHeight });

      var pr = paddingRight !== undefined ? paddingRight : Math.round(height / 2); // eslint-disable-line no-negated-condition
      var pl = paddingLeft !== undefined ? paddingLeft : Math.round(height / 2); // eslint-disable-line no-negated-condition

      var iconBefore = void 0;
      if (iconBeforeKey) {
        iconBefore = _react2.default.createElement(_icons.IconMap[iconBeforeKey], {
          aim: iconBeforeAim,
          iconSize: iconSize,
          color: 'inherit',
          size: iconHeight,
          marginLeft: -Math.round(pl * 0.6)
        });
      }

      var iconAfter = void 0;
      if (iconAfterKey) {
        iconAfter = _react2.default.createElement(_icons.IconMap[iconAfterKey], {
          aim: iconAfterAim,
          iconSize: iconSize,
          color: 'inherit',
          size: iconHeight,
          marginRight: -Math.round(pl * 0.6)
        });
      }

      return _react2.default.createElement(
        _typography.Text,
        _extends({
          is: 'button',
          borderTopRightRadius: borderRadius,
          borderBottomRightRadius: borderRadius,
          borderTopLeftRadius: borderRadius,
          borderBottomLeftRadius: borderRadius,
          paddingTop: paddingTop,
          paddingBottom: paddingBottom,
          paddingRight: pr,
          paddingLeft: pl,
          margin: 0 // Removes weird margins in Safari
        }, textStyle, {
          color: null // Prevent the Text color overriding the glamor appearanceStyle color
          , css: _extends({}, appearanceStyle, css),
          height: height,
          lineHeight: height + 'px'
        }, isActive ? { 'data-active': true } : {}, Button.styles, props, {
          disabled: disabled || isLoading
        }),
        isLoading && _react2.default.createElement(_spinner.Spinner, {
          marginLeft: -Math.round(height / 8),
          marginRight: Math.round(height / 4),
          size: Math.round(height / 2)
        }),
        iconBefore || null,
        children,
        iconAfter || null
      );
    }
  }]);

  return Button;
}(_react.PureComponent);

Button.propTypes = _extends({}, _typography.Text.propTypes, {

  /**
   * The appearance of the button.
   */
  appearance: _propTypes2.default.oneOf(Object.keys(_ButtonAppearances2.default)).isRequired,

  /**
   * When true, show a loading spinner before the children.
   * This also disables the button.
   */
  isLoading: _propTypes2.default.bool,

  /**
   * Forcefully set the active state of a button.
   * Useful in conjuction with a Popover.
   */
  isActive: _propTypes2.default.bool,

  /**
   * Sets an icon before the text. Can be any icon from Evergreen.
   */
  iconBefore: _propTypes2.default.oneOf(Object.keys(_icons.IconMap)),

  /**
   * The aim of the left icon. Not a big use case for this.
   */
  iconBeforeAim: _propTypes2.default.oneOf(Object.keys(_icons.IconAim)),

  /**
   * Sets an icon after the text. Can be any icon from Evergreen.
   */
  iconAfter: _propTypes2.default.oneOf(Object.keys(_icons.IconMap)),

  /**
   * The aim of the right icon. Useful to aim a triangle down.
   */
  iconAfterAim: _propTypes2.default.oneOf(Object.keys(_icons.IconAim)),

  /**
   * When true, the button is disabled.
   * isLoading also sets the button to disabled.
   */
  disabled: _propTypes2.default.bool
});
Button.defaultProps = {
  appearance: 'default',
  isActive: false,
  iconBeforeAim: 'none',
  iconAfterAim: 'none',
  height: 32,
  paddingTop: 0,
  paddingBottom: 0
};
Button.styles = {
  position: 'relative',
  fontFamily: 'ui',
  fontWeight: 500,
  display: 'inline-flex',
  alignItems: 'center',
  flexWrap: 'nowrap'
};
exports.default = Button;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9idXR0b25zL3NyYy9CdXR0b24uanMiXSwibmFtZXMiOlsiQnV0dG9uIiwicHJvcHMiLCJjc3MiLCJoZWlnaHQiLCJpc0FjdGl2ZSIsImNoaWxkcmVuIiwiZGlzYWJsZWQiLCJhcHBlYXJhbmNlIiwiaXNMb2FkaW5nIiwicGFkZGluZ1JpZ2h0IiwicGFkZGluZ0xlZnQiLCJwYWRkaW5nVG9wIiwicGFkZGluZ0JvdHRvbSIsImljb25CZWZvcmVLZXkiLCJpY29uQmVmb3JlIiwiaWNvbkJlZm9yZUFpbSIsImljb25BZnRlcktleSIsImljb25BZnRlciIsImljb25BZnRlckFpbSIsImFwcGVhcmFuY2VTdHlsZSIsInRleHRTdHlsZSIsImJvcmRlclJhZGl1cyIsImljb25IZWlnaHQiLCJpY29uU2l6ZSIsInByIiwidW5kZWZpbmVkIiwiTWF0aCIsInJvdW5kIiwicGwiLCJjcmVhdGVFbGVtZW50IiwiYWltIiwiY29sb3IiLCJzaXplIiwibWFyZ2luTGVmdCIsIm1hcmdpblJpZ2h0Iiwic3R5bGVzIiwicHJvcFR5cGVzIiwib25lT2YiLCJPYmplY3QiLCJrZXlzIiwiaXNSZXF1aXJlZCIsImJvb2wiLCJkZWZhdWx0UHJvcHMiLCJwb3NpdGlvbiIsImZvbnRGYW1pbHkiLCJmb250V2VpZ2h0IiwiZGlzcGxheSIsImFsaWduSXRlbXMiLCJmbGV4V3JhcCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7QUFLQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7SUFFcUJBLE07Ozs7Ozs7Ozs7OzZCQXNFVjtBQUFBLG1CQXVCSCxLQUFLQyxLQXZCRjtBQUFBLFVBRUxDLEdBRkssVUFFTEEsR0FGSztBQUFBLFVBR0xDLE1BSEssVUFHTEEsTUFISztBQUFBLFVBSUxDLFFBSkssVUFJTEEsUUFKSztBQUFBLFVBS0xDLFFBTEssVUFLTEEsUUFMSztBQUFBLFVBTUxDLFFBTkssVUFNTEEsUUFOSztBQUFBLFVB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QUFjLElBL0JqQjtBQWdDR1QsZ0JBaENIO0FBaUNHWSxxQkFBYTtBQWpDaEIsT0FERjtBQXFDRDs7Ozs7O0FBbktrQmpCLE0sQ0FDWm9DLFMsZ0JBSUYsaUJBQUtBLFM7O0FBRVI7OztBQUdBN0IsY0FBWSxvQkFBVThCLEtBQVYsQ0FBZ0JDLE9BQU9DLElBQVAsNkJBQWhCLEVBQWdEQyxVOztBQUU1RDs7OztBQUlBaEMsYUFBVyxvQkFBVWlDLEk7O0FBRXJCOzs7O0FBSUFyQyxZQUFVLG9CQUFVcUMsSTs7QUFFcEI7OztBQUdBM0IsY0FBWSxvQkFBVXVCLEtBQVYsQ0FBZ0JDLE9BQU9DLElBQVAsZ0JBQWhCLEM7O0FBRVo7OztBQUdBeEIsaUJBQWUsb0JBQVVzQixLQUFWLENBQWdCQyxPQUFPQyxJQUFQLGdCQUFoQixDOztBQUVmOzs7QUFHQXRCLGFBQVcsb0JBQVVvQixLQUFWLENBQWdCQyxPQUFPQyxJQUFQLGdCQUFoQixDOztBQUVYOzs7QUFHQXJCLGdCQUFjLG9CQUFVbUIsS0FBVixDQUFnQkMsT0FBT0MsSUFBUCxnQkFBaEIsQzs7QUFFZDs7OztBQUlBakMsWUFBVSxvQkFBVW1DOztBQWhESHpDLE0sQ0FtRFowQyxZLEdBQWU7QUFDcEJuQyxjQUFZLFNBRFE7QUFFcEJILFlBQVUsS0FGVTtBQUdwQlcsaUJBQWUsTUFISztBQUlwQkcsZ0JBQWMsTUFKTTtBQUtwQmYsVUFBUSxFQUxZO0FBTXBCUSxjQUFZLENBTlE7QUFPcEJDLGlCQUFlO0FBUEssQztBQW5ESFosTSxDQTZEWm1DLE0sR0FBUztBQUNkUSxZQUFVLFVBREk7QUFFZEMsY0FBWSxJQUZFO0FBR2RDLGNBQVksR0FIRTtBQUlkQyxXQUFTLGFBSks7QUFLZEMsY0FBWSxRQUxFO0FBTWRDLFlBQVU7QUFOSSxDO2tCQTdER2hELE0iLCJmaWxlIjoiQnV0dG9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFB1cmVDb21wb25lbnQgfSBmcm9tICdyZWFjdCdcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCB7IFRleHQgfSBmcm9tICcuLi8uLi90eXBvZ3JhcGh5J1xuaW1wb3J0IHsgSWNvbk1hcCwgSWNvbkFpbSB9IGZyb20gJy4uLy4uL2ljb25zJ1xuaW1wb3J0IHtcbiAgZ2V0Qm9yZGVyUmFkaXVzRm9yQ29udHJvbEhlaWdodCxcbiAgZ2V0VGV4dFN0eWxlRm9yQ29udHJvbEhlaWdodCxcbiAgZ2V0SWNvblNpemVGb3JDb250cm9sSGVpZ2h0XG59IGZyb20gJy4uLy4uL3NoYXJlZC1zdHlsZXMnXG5pbXBvcnQgeyBTcGlubmVyIH0gZnJvbSAnLi4vLi4vc3Bpbm5lcidcbmltcG9ydCBCdXR0b25BcHBlYXJhbmNlcyBmcm9tICcuL3N0eWxlcy9CdXR0b25BcHBlYXJhbmNlcydcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQnV0dG9uIGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgLyoqXG4gICAgICogQ29tcG9zZXMgdGhlIFRleHQgY29tcG9uZW50IGFzIHRoZSBiYXNlLlxuICAgICAqL1xuICAgIC4uLlRleHQucHJvcFR5cGVzLFxuXG4gICAgLyoqXG4gICAgICogVGhlIGFwcGVhcmFuY2Ugb2YgdGhlIGJ1dHRvbi5cbiAgICAgKi9cbiAgICBhcHBlYXJhbmNlOiBQcm9wVHlwZXMub25lT2YoT2JqZWN0LmtleXMoQnV0dG9uQXBwZWFyYW5jZXMpKS5pc1JlcXVpcmVkLFxuXG4gICAgLyoqXG4gICAgICogV2hlbiB0cnVlLCBzaG93IGEgbG9hZGluZyBzcGlubmVyIGJlZm9yZSB0aGUgY2hpbGRyZW4uXG4gICAgICogVGhpcyBhbHNvIGRpc2FibGVzIHRoZSBidXR0b24uXG4gICAgICovXG4gICAgaXNMb2FkaW5nOiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIC8qKlxuICAgICAqIEZvcmNlZnVsbHkgc2V0IHRoZSBhY3RpdmUgc3RhdGUgb2YgYSBidXR0b24uXG4gICAgICogVXNlZnVsIGluIGNvbmp1Y3Rpb24gd2l0aCBhIFBvcG92ZXIuXG4gICAgICovXG4gICAgaXNBY3RpdmU6IFByb3BUeXBlcy5ib29sLFxuXG4gICAgLyoqXG4gICAgICogU2V0cyBhbiBpY29uIGJlZm9yZSB0aGUgdGV4dC4gQ2FuIGJlIGFueSBpY29uIGZyb20gRXZlcmdyZWVuLlxuICAgICAqL1xuICAgIGljb25CZWZvcmU6IFByb3BUeXBlcy5vbmVPZihPYmplY3Qua2V5cyhJY29uTWFwKSksXG5cbiAgICAvKipcbiAgICAgKiBUaGUgYWltIG9mIHRoZSBsZWZ0IGljb24uIE5vdCBhIGJpZyB1c2UgY2FzZSBmb3IgdGhpcy5cbiAgICAgKi9cbiAgICBpY29uQmVmb3JlQWltOiBQcm9wVHlwZXMub25lT2YoT2JqZWN0LmtleXMoSWNvbkFpbSkpLFxuXG4gICAgLyoqXG4gICAgICogU2V0cyBhbiBpY29uIGFmdGVyIHRoZSB0ZXh0LiBDYW4gYmUgYW55IGljb24gZnJvbSBFdmVyZ3JlZW4uXG4gICAgICovXG4gICAgaWNvbkFmdGVyOiBQcm9wVHlwZXMub25lT2YoT2JqZWN0LmtleXMoSWNvbk1hcCkpLFxuXG4gICAgLyoqXG4gICAgICogVGhlIGFpbSBvZiB0aGUgcmlnaHQgaWNvbi4gVXNlZnVsIHRvIGFpbSBhIHRyaWFuZ2xlIGRvd24uXG4gICAgICovXG4gICAgaWNvbkFmdGVyQWltOiBQcm9wVHlwZXMub25lT2YoT2JqZWN0LmtleXMoSWNvbkFpbSkpLFxuXG4gICAgLyoqXG4gICAgICogV2hlbiB0cnVlLCB0aGUgYnV0dG9uIGlzIGRpc2FibGVkLlxuICAgICAqIGlzTG9hZGluZyBhbHNvIHNldHMgdGhlIGJ1dHRvbiB0byBkaXNhYmxlZC5cbiAgICAgKi9cbiAgICBkaXNhYmxlZDogUHJvcFR5cGVzLmJvb2xcbiAgfVxuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgYXBwZWFyYW5jZTogJ2RlZmF1bHQnLFxuICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICBpY29uQmVmb3JlQWltOiAnbm9uZScsXG4gICAgaWNvbkFmdGVyQWltOiAnbm9uZScsXG4gICAgaGVpZ2h0OiAzMixcbiAgICBwYWRkaW5nVG9wOiAwLFxuICAgIHBhZGRpbmdCb3R0b206IDBcbiAgfVxuXG4gIHN0YXRpYyBzdHlsZXMgPSB7XG4gICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgZm9udEZhbWlseTogJ3VpJyxcbiAgICBmb250V2VpZ2h0OiA1MDAsXG4gICAgZGlzcGxheTogJ2lubGluZS1mbGV4JyxcbiAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgICBmbGV4V3JhcDogJ25vd3JhcCdcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBjc3MsXG4gICAgICBoZWlnaHQsXG4gICAgICBpc0FjdGl2ZSxcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgZGlzYWJsZWQsXG4gICAgICBhcHBlYXJhbmNlLFxuICAgICAgaXNMb2FkaW5nLFxuXG4gICAgICAvLyBQYWRkaW5nc1xuICAgICAgcGFkZGluZ1JpZ2h0LFxuICAgICAgcGFkZGluZ0xlZnQsXG4gICAgICBwYWRkaW5nVG9wLFxuICAgICAgcGFkZGluZ0JvdHRvbSxcblxuICAgICAgLy8gSWNvbnNcbiAgICAgIGljb25CZWZvcmU6IGljb25CZWZvcmVLZXksXG4gICAgICBpY29uQmVmb3JlQWltLFxuICAgICAgaWNvbkFmdGVyOiBpY29uQWZ0ZXJLZXksXG4gICAgICBpY29uQWZ0ZXJBaW0sXG5cbiAgICAgIC4uLnByb3BzXG4gICAgfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCBhcHBlYXJhbmNlU3R5bGUgPSBCdXR0b25BcHBlYXJhbmNlc1thcHBlYXJhbmNlXVxuICAgIGNvbnN0IHRleHRTdHlsZSA9IGdldFRleHRTdHlsZUZvckNvbnRyb2xIZWlnaHQoeyBoZWlnaHQgfSlcbiAgICBjb25zdCBib3JkZXJSYWRpdXMgPSBnZXRCb3JkZXJSYWRpdXNGb3JDb250cm9sSGVpZ2h0KHsgaGVpZ2h0IH0pXG4gICAgY29uc3QgaWNvbkhlaWdodCA9IGhlaWdodCAtIDRcbiAgICBjb25zdCBpY29uU2l6ZSA9IGdldEljb25TaXplRm9yQ29udHJvbEhlaWdodCh7IGhlaWdodDogaWNvbkhlaWdodCB9KVxuXG4gICAgY29uc3QgcHIgPVxuICAgICAgcGFkZGluZ1JpZ2h0ICE9PSB1bmRlZmluZWQgPyBwYWRkaW5nUmlnaHQgOiBNYXRoLnJvdW5kKGhlaWdodCAvIDIpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tbmVnYXRlZC1jb25kaXRpb25cbiAgICBjb25zdCBwbCA9IHBhZGRpbmdMZWZ0ICE9PSB1bmRlZmluZWQgPyBwYWRkaW5nTGVmdCA6IE1hdGgucm91bmQoaGVpZ2h0IC8gMikgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZWdhdGVkLWNvbmRpdGlvblxuXG4gICAgbGV0IGljb25CZWZvcmVcbiAgICBpZiAoaWNvbkJlZm9yZUtleSkge1xuICAgICAgaWNvbkJlZm9yZSA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoSWNvbk1hcFtpY29uQmVmb3JlS2V5XSwge1xuICAgICAgICBhaW06IGljb25CZWZvcmVBaW0sXG4gICAgICAgIGljb25TaXplLFxuICAgICAgICBjb2xvcjogJ2luaGVyaXQnLFxuICAgICAgICBzaXplOiBpY29uSGVpZ2h0LFxuICAgICAgICBtYXJnaW5MZWZ0OiAtTWF0aC5yb3VuZChwbCAqIDAuNilcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgbGV0IGljb25BZnRlclxuICAgIGlmIChpY29uQWZ0ZXJLZXkpIHtcbiAgICAgIGljb25BZnRlciA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoSWNvbk1hcFtpY29uQWZ0ZXJLZXldLCB7XG4gICAgICAgIGFpbTogaWNvbkFmdGVyQWltLFxuICAgICAgICBpY29uU2l6ZSxcbiAgICAgICAgY29sb3I6ICdpbmhlcml0JyxcbiAgICAgICAgc2l6ZTogaWNvbkhlaWdodCxcbiAgICAgICAgbWFyZ2luUmlnaHQ6IC1NYXRoLnJvdW5kKHBsICogMC42KVxuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFRleHRcbiAgICAgICAgaXM9XCJidXR0b25cIlxuICAgICAgICBib3JkZXJUb3BSaWdodFJhZGl1cz17Ym9yZGVyUmFkaXVzfVxuICAgICAgICBib3JkZXJCb3R0b21SaWdodFJhZGl1cz17Ym9yZGVyUmFkaXVzfVxuICAgICAgICBib3JkZXJUb3BMZWZ0UmFkaXVzPXtib3JkZXJSYWRpdXN9XG4gICAgICAgIGJvcmRlckJvdHRvbUxlZnRSYWRpdXM9e2JvcmRlclJhZGl1c31cbiAgICAgICAgcGFkZGluZ1RvcD17cGFkZGluZ1RvcH1cbiAgICAgICAgcGFkZGluZ0JvdHRvbT17cGFkZGluZ0JvdHRvbX1cbiAgICAgICAgcGFkZGluZ1JpZ2h0PXtwcn1cbiAgICAgICAgcGFkZGluZ0xlZnQ9e3BsfVxuICAgICAgICBtYXJnaW49ezB9IC8vIFJlbW92ZXMgd2VpcmQgbWFyZ2lucyBpbiBTYWZhcmlcbiAgICAgICAgey4uLnRleHRTdHlsZX1cbiAgICAgICAgY29sb3I9e251bGx9IC8vIFByZXZlbnQgdGhlIFRleHQgY29sb3Igb3ZlcnJpZGluZyB0aGUgZ2xhbW9yIGFwcGVhcmFuY2VTdHlsZSBjb2xvclxuICAgICAgICBjc3M9e3tcbiAgICAgICAgICAuLi5hcHBlYXJhbmNlU3R5bGUsXG4gICAgICAgICAgLi4uY3NzXG4gICAgICAgIH19XG4gICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICBsaW5lSGVpZ2h0PXtgJHtoZWlnaHR9cHhgfVxuICAgICAgICB7Li4uKGlzQWN0aXZlID8geyAnZGF0YS1hY3RpdmUnOiB0cnVlIH0gOiB7fSl9XG4gICAgICAgIHsuLi5CdXR0b24uc3R5bGVzfVxuICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgIGRpc2FibGVkPXtkaXNhYmxlZCB8fCBpc0xvYWRpbmd9XG4gICAgICA+XG4gICAgICAgIHtpc0xvYWRpbmcgJiYgKFxuICAgICAgICAgIDxTcGlubmVyXG4gICAgICAgICAgICBtYXJnaW5MZWZ0PXstTWF0aC5yb3VuZChoZWlnaHQgLyA4KX1cbiAgICAgICAgICAgIG1hcmdpblJpZ2h0PXtNYXRoLnJvdW5kKGhlaWdodCAvIDQpfVxuICAgICAgICAgICAgc2l6ZT17TWF0aC5yb3VuZChoZWlnaHQgLyAyKX1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgICB7aWNvbkJlZm9yZSB8fCBudWxsfVxuICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgIHtpY29uQWZ0ZXIgfHwgbnVsbH1cbiAgICAgIDwvVGV4dD5cbiAgICApXG4gIH1cbn1cbiJdfQ==